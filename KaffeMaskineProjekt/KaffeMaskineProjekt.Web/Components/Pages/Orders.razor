@page "/orders"
@rendermode InteractiveServer
@inject KaffeApiClient KaffeApiClient
@using KaffeMaskineProjekt.DTO
@using KaffeMaskineProjekt.DomainModels

<h3>Orders</h3>

<p>Create a new order:</p>

<select @bind="selectedRecipeId">
    @foreach (var recipe in recipes)
    {
        <option value="@recipe.Id">@recipe.Name</option>
    }
</select>

<button type="button" @onclick="CreateOrder">Create Order</button>

<p>Current Orders:</p>
<ul>
    @foreach (var order in orders)
    {
        <li>
            <p>
                Order for: @order.User.Name - Recipe: @order.Recipe.Name -
                <span style="text-decoration:underline;text-decoration-color:red;" @onclick="@(async () => await DeleteOrder(order.Id))">Delete</span>
            </p>
        </li>
    }
</ul>

@code {
    private List<Order> orders = new List<Order>();
    private List<RecipeDTO> recipes = new List<RecipeDTO>();
    private int selectedRecipeId;

    protected override async Task OnInitializedAsync()
    {
        orders = await KaffeApiClient.GetOrdersAsync();
        recipes = await KaffeApiClient.GetRecipesAsync();
    }

    private async Task CreateOrder()
    {
        if (selectedRecipeId > 0)
        {
            var order = await KaffeApiClient.CreateOrderAsync(selectedRecipeId);
            if (order != null)
            {
                orders = await KaffeApiClient.GetOrdersAsync(); // Refresh the order list
            }
        }
    }

    private async Task DeleteOrder(int orderId)
    {
        await KaffeApiClient.DeleteOrderAsync(orderId);
        orders = await KaffeApiClient.GetOrdersAsync(); // Refresh the order list
    }
}
